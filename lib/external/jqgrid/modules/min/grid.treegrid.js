(function(f){"function"===typeof define&&define.amd?define(["jquery","./grid.base"],f):"object"===typeof exports?f(require("jquery")):f(jQuery)})(function(f){var v=f.jgrid,y=v.getAccessor,D=v.stripPref,A=v.jqID,l=f.fn.jqGrid,u=function(){var b=f.makeArray(arguments);b[0]="treeGrid"+b[0].charAt(0).toUpperCase()+b[0].substring(1);b.unshift("");b.unshift("");b.unshift(this.p);return v.feedback.apply(this,b)};v.extend({setTreeNode:function(){return this.each(function(){var b=f(this),a=this.p;if(this.grid&&
a.treeGrid){var c=a.treeReader.expanded_field,g=a.treeReader.leaf_field;b.unbind("jqGridBeforeSelectRow.setTreeNode");b.bind("jqGridBeforeSelectRow.setTreeNode",function(d,h,e){if(null!=e){d=f(e.target);e=d.closest("tr.jqgrow>td");var k=e.parent(),m=function(){var e=a.data[a._index[D(a.idPrefix,h)]],d=e[c]?"collapse":"expand";e[g]||(l[d+"Row"].call(b,e,k),l[d+"Node"].call(b,e,k))};d.is("div.treeclick")?m():a.ExpandColClick&&0<e.length&&0<d.closest("span.cell-wrapper",e).length&&m();return!0}})}})},
setTreeGrid:function(){return this.each(function(){var b=this.p,a,c,g,d=[],h=["leaf_field","expanded_field","loaded"];if(b.treeGrid){b.treedatatype||f.extend(this.p,{treedatatype:b.datatype});b.subGrid=!1;b.altRows=!1;b.pgbuttons=!1;b.pginput=!1;b.gridview=!0;null===b.rowTotal&&(b.rowNum=b.maxRowNum);b.rowList=[];b.treeIcons.plus="rtl"===b.direction?b.treeIcons.plusRtl:b.treeIcons.plusLtr;"nested"===b.treeGridModel?b.treeReader=f.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",
expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},b.treeReader):"adjacency"===b.treeGridModel&&(b.treeReader=f.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},b.treeReader));for(c in b.colModel)if(b.colModel.hasOwnProperty(c))for(g in a=b.colModel[c].name,b.treeReader)b.treeReader.hasOwnProperty(g)&&b.treeReader[g]===a&&d.push(a);f.each(b.treeReader,function(a){var c=String(this);c&&-1===f.inArray(c,d)&&
(0<=f.inArray(a,h)?b.additionalProperties.push({name:c,search:!1,convert:function(a){return!0===a||"true"===String(a).toLowerCase()||"1"===String(a)?!0:a}}):b.additionalProperties.push(c))})}})},expandRow:function(b){this.each(function(){var a=f(this),c=this.p;if(this.grid&&c.treeGrid){var g=c.treeReader.expanded_field,d=b[c.localReader.id];if(u.call(this,"beforeExpandRow",{rowid:d,item:b})){var h=l.getNodeChildren.call(a,b);f(h).each(function(){var b=c.idPrefix+y(this,c.localReader.id);f(l.getGridRowById.call(a,
b)).css("display","");this[g]&&l.expandRow.call(a,this)});u.call(this,"afterExpandRow",{rowid:d,item:b})}}})},collapseRow:function(b){this.each(function(){var a=f(this),c=this.p;if(this.grid&&c.treeGrid){var g=c.treeReader.expanded_field,d=b[c.localReader.id];if(u.call(this,"beforeCollapseRow",{rowid:d,item:b})){var h=l.getNodeChildren.call(a,b);f(h).each(function(){var b=c.idPrefix+y(this,c.localReader.id);f(l.getGridRowById.call(a,b)).css("display","none");this[g]&&l.collapseRow.call(a,this)});
u.call(this,"afterCollapseRow",{rowid:d,item:b})}}})},getRootNodes:function(){var b=[];this.each(function(){var a=this.p;if(this.grid&&a.treeGrid)switch(a.treeGridModel){case "nested":var c=a.treeReader.level_field;f(a.data).each(function(){parseInt(this[c],10)===parseInt(a.tree_root_level,10)&&b.push(this)});break;case "adjacency":var g=a.treeReader.parent_id_field;f(a.data).each(function(){null!==this[g]&&"null"!==String(this[g]).toLowerCase()||b.push(this)})}});return b},getNodeDepth:function(b){var a=
null;this.each(function(){var c=this.p;if(this.grid&&c.treeGrid)switch(c.treeGridModel){case "nested":a=parseInt(b[c.treeReader.level_field],10)-parseInt(c.tree_root_level,10);break;case "adjacency":a=l.getNodeAncestors.call(f(this),b).length}});return a},getNodeParent:function(b){var a=this[0];if(!a||!a.grid||null==a.p||!a.p.treeGrid||null==b)return null;var a=a.p,c=a.treeReader,g=b[c.parent_id_field];if("nested"===a.treeGridModel){var d=null,h=c.left_field,e=c.right_field,k=c.level_field,m=parseInt(b[h],
10),l=parseInt(b[e],10),n=parseInt(b[k],10);f(a.data).each(function(){if(parseInt(this[k],10)===n-1&&parseInt(this[h],10)<m&&parseInt(this[e],10)>l)return d=this,!1});return d}if(null===g||"null"===g)return null;b=a._index[g];return void 0!==b?a.data[b]:null},getNodeChildren:function(b){var a=[];this.each(function(){var c=this.p;if(this.grid&&c.treeGrid)switch(c.treeGridModel){case "nested":var g=c.treeReader.left_field,d=c.treeReader.right_field,h=c.treeReader.level_field,e=parseInt(b[g],10),k=parseInt(b[d],
10),m=parseInt(b[h],10);f(c.data).each(function(){parseInt(this[h],10)===m+1&&parseInt(this[g],10)>e&&parseInt(this[d],10)<k&&a.push(this)});break;case "adjacency":var l=c.treeReader.parent_id_field,n=c.localReader.id;f(c.data).each(function(){String(this[l])===String(b[n])&&a.push(this)})}});return a},getFullTreeNode:function(b){var a=[];this.each(function(){var c=this.p,g;if(this.grid&&c.treeGrid)switch(c.treeGridModel){case "nested":var d=c.treeReader.left_field,h=c.treeReader.right_field,e=c.treeReader.level_field,
k=parseInt(b[d],10),m=parseInt(b[h],10),l=parseInt(b[e],10);f(c.data).each(function(){parseInt(this[e],10)>=l&&parseInt(this[d],10)>=k&&parseInt(this[d],10)<=m&&a.push(this)});break;case "adjacency":if(b){a.push(b);var n=c.treeReader.parent_id_field,v=c.localReader.id;f(c.data).each(function(){var b;g=a.length;for(b=0;b<g;b++)if(String(a[b][v])===String(this[n])){a.push(this);break}})}}});return a},getNodeAncestors:function(b){var a=[];this.each(function(){var c=f(this),g=l.getNodeParent;if(this.grid&&
this.p.treeGrid)for(var d=g.call(c,b);d;)a.push(d),d=g.call(c,d)});return a},isVisibleNode:function(b){var a=!0;this.each(function(){var c=this.p;if(this.grid&&c.treeGrid){var g=l.getNodeAncestors.call(f(this),b),d=c.treeReader.expanded_field;f(g).each(function(){a=a&&this[d];if(!a)return!1})}});return a},isNodeLoaded:function(b){var a;this.each(function(){var c=this.p;if(this.grid&&c.treeGrid){var g=c.treeReader.leaf_field,c=c.treeReader.loaded;a=void 0!==b?void 0!==b[c]?b[c]:b[g]||0<l.getNodeChildren.call(f(this),
b).length?!0:!1:!1}});return a},expandNode:function(b){return this.each(function(){var a=this.p;if(this.grid&&a.treeGrid){var c=a.treeReader.expanded_field,g=a.treeReader.parent_id_field,d=a.treeReader.loaded,h=a.treeReader.level_field,e=a.treeReader.left_field,k=a.treeReader.right_field;if(!b[c]){var m=y(b,a.localReader.id);if(u.call(this,"beforeExpandNode",{rowid:m,item:b})){var q=f("#"+a.idPrefix+A(m),this.grid.bDiv)[0],n=a._index[m];"local"===a.treedatatype||l.isNodeLoaded.call(f(this),a.data[n])?
(b[c]=!0,f("div.treeclick",q).removeClass(a.treeIcons.plus+" tree-plus").addClass(a.treeIcons.commonIconClass).addClass(a.treeIcons.minus+" tree-minus")):this.grid.hDiv.loading||(b[c]=!0,f("div.treeclick",q).removeClass(a.treeIcons.plus+" tree-plus").addClass(a.treeIcons.commonIconClass).addClass(a.treeIcons.minus+" tree-minus"),a.treeANode=q.rowIndex,a.datatype=a.treedatatype,l.setGridParam.call(f(this),{postData:"nested"===a.treeGridModel?{nodeid:m,n_level:b[h],n_left:b[e],n_right:b[k]}:{nodeid:m,
n_level:b[h],parentid:b[g]}}),f(this).trigger("reloadGrid"),b[d]=!0,l.setGridParam.call(f(this),{postData:"nested"===a.treeGridModel?{nodeid:"",n_level:"",n_left:"",n_right:""}:{nodeid:"",n_level:"",parentid:""}}));u.call(this,"afterExpandNode",{rowid:m,item:b})}}}})},collapseNode:function(b){return this.each(function(){var a=this.p;if(this.grid&&a.treeGrid){var c=a.treeReader.expanded_field;if(b[c]){var g=y(b,a.localReader.id);u.call(this,"beforeCollapseNode",{rowid:g,item:b})&&(b[c]=!1,c=f("#"+
a.idPrefix+A(g),this.grid.bDiv)[0],f("div.treeclick",c).removeClass(a.treeIcons.minus+" tree-minus").addClass(a.treeIcons.commonIconClass).addClass(a.treeIcons.plus+" tree-plus"),u.call(this,"afterCollapseNode",{rowid:g,item:b}))}}})},SortTree:function(b,a,c,g){return this.each(function(){var d=this,h=d.p,e=f(d);if(d.grid&&h.treeGrid){var k,m,q,n=[];k=l.getRootNodes.call(e);k=v.from.call(d,k);k.orderBy(b,a,c,g);var u=k.select();k=0;for(m=u.length;k<m;k++)q=u[k],n.push(q),l.collectChildrenSortTree.call(e,
n,q,b,a,c,g);f.each(n,function(a){var b=y(this,h.localReader.id);f(d.rows[a]).after(e.find(">tbody>tr#"+A(b)))})}})},collectChildrenSortTree:function(b,a,c,g,d,h){return this.each(function(){var e=f(this);if(this.grid&&this.p.treeGrid){var k,m,q;k=l.getNodeChildren.call(e,a);k=v.from.call(this,k);k.orderBy(c,g,d,h);var n=k.select();k=0;for(m=n.length;k<m;k++)q=n[k],b.push(q),l.collectChildrenSortTree.call(e,b,q,c,g,d,h)}})},setTreeRow:function(b,a){var c=!1;this.each(function(){this.grid&&this.p.treeGrid&&
(c=l.setRowData.call(f(this),b,a))});return c},delTreeNode:function(b){return this.each(function(){var a=this.p,c,g,d,h;d=a.localReader.id;var e,k=f(this),m=a.treeReader.left_field,q=a.treeReader.right_field;if(this.grid&&a.treeGrid&&(e=a._index[b],void 0!==e)){c=parseInt(a.data[e][q],10);g=c-parseInt(a.data[e][m],10)+1;var n=l.getFullTreeNode.call(k,a.data[e]);if(0<n.length)for(e=0;e<n.length;e++)l.delRowData.call(k,n[e][d]);if("nested"===a.treeGridModel){d=v.from.call(this,a.data).greater(m,c,{stype:"integer"}).select();
if(d.length)for(h in d)d.hasOwnProperty(h)&&(d[h][m]=parseInt(d[h][m],10)-g);d=v.from.call(this,a.data).greater(q,c,{stype:"integer"}).select();if(d.length)for(h in d)d.hasOwnProperty(h)&&(d[h][q]=parseInt(d[h][q],10)-g)}}})},addChildNode:function(b,a,c,g){var d=f(this),h=d[0],e=h.p,k=l.getInd;if(c){var m,q,n,u,w;m=0;var y=a,A,t,B=e.treeReader.expanded_field;t=e.treeReader.leaf_field;var p=e.treeReader.level_field,D=e.treeReader.parent_id_field,z=e.treeReader.left_field,x=e.treeReader.right_field,
E=e.treeReader.loaded;void 0===g&&(g=!1);if(null==b){w=e.data.length-1;if(0<=w)for(;0<=w;)m=Math.max(m,parseInt(e.data[w][e.localReader.id],10)),w--;b=m+1}var I=k.call(d,a);A=!1;if(void 0===a||null===a||""===a)y=a=null,m="last",u=e.tree_root_level,w=e.data.length+1;else{m="after";q=e._index[a];n=e.data[q];a=n[e.localReader.id];w=k.call(d,a);u=parseInt(n[p],10)+1;var F=l.getFullTreeNode.call(d,n);if(F.length){var C,G,H;for(C=0;C<F.length;C++)H=F[C][e.localReader.id],G=k.call(d,H),G>w&&(w=G,y=H)}w++;
n[t]&&(A=!0,n[B]=!0,f(h.rows[I]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(e.treeIcons.leaf+" tree-leaf").addClass(e.treeIcons.commonIconClass).addClass(e.treeIcons.minus+" tree-minus"),e.data[q][t]=!1,n[E]=!0)}k=w+1;void 0===c[B]&&(c[B]=!1);void 0===c[E]&&(c[E]=!1);c[p]=u;void 0===c[t]&&(c[t]=!0);"adjacency"===e.treeGridModel&&(c[D]=a);if("nested"===e.treeGridModel){var r;if(null!==a){t=parseInt(n[x],10);e=v.from.call(h,
e.data);e=e.greaterOrEquals(x,t,{stype:"integer"});p=e.select();if(p.length)for(r in p)p.hasOwnProperty(r)&&(p[r][z]=p[r][z]>t?parseInt(p[r][z],10)+2:p[r][z],p[r][x]=p[r][x]>=t?parseInt(p[r][x],10)+2:p[r][x]);c[z]=t;c[x]=t+1}else{t=parseInt(l.getCol.call(d,x,!1,"max"),10);p=v.from.call(h,e.data).greater(z,t,{stype:"integer"}).select();if(p.length)for(r in p)p.hasOwnProperty(r)&&(p[r][z]=parseInt(p[r][z],10)+2);p=v.from.call(h,e.data).greater(x,t,{stype:"integer"}).select();if(p.length)for(r in p)p.hasOwnProperty(r)&&
(p[r][x]=parseInt(p[r][x],10)+2);c[z]=t+1;c[x]=t+2}}if(null===a||l.isNodeLoaded.call(d,n)||A)l.addRowData.call(d,b,c,m,y),l.setTreeNode.call(d,w,k);n&&!n[B]&&g&&f(h.rows[I]).find("div.treeclick").click()}}})});
//# sourceMappingURL=grid.treegrid.map
