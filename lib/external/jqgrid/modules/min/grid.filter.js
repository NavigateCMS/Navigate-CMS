(function(b){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],b):"object"===typeof exports?b(require("jquery")):b(jQuery)})(function(b){var p=b.jgrid;b.fn.jqFilter=function(e){if("string"===typeof e){var u=b.fn.jqFilter[e];if(!u)throw"jqFilter - No such method: "+e;var C=b.makeArray(arguments).slice(1);return u.apply(this,C)}var a=b.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,
sopt:null,ops:[],operands:null,numopts:"eq ne lt le gt ge nu nn in ni".split(" "),stropts:"eq ne bw bn ew en cn nc nu nn in ni".split(" "),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},p.filter,e||{});return this.each(function(){if(!this.filter){this.p=a;if(null===a.filter||void 0===a.filter)a.filter={groupOp:a.groupOps[0].op,rules:[],groups:[]};var e,u=a.columns.length,f,E=/msie/i.test(navigator.userAgent)&&!window.opera,
v=function(){return b("#"+p.jqID(a.id))[0]||null},t=function(h,a){return b(v()).jqGrid("getGuiStyles",h,a||"")},A=function(h){return b(v()).jqGrid("getGridRes","search."+h)},F=function(b){var a=v(),c=a.p.iColByName[b];if(void 0!==c)return{cm:a.p.colModel[c],iCol:c};c=a.p.iPropByName[b];return void 0!==c?{cm:a.p.colModel[c],iCol:c,isAddProp:!0}:{cm:null,iCol:-1}},D=t("states.error"),C=t("dialog.content");a.initFilter=b.extend(!0,{},a.filter);if(u){for(e=0;e<u;e++)f=a.columns[e],f.stype?f.inputtype=
f.stype:f.inputtype||(f.inputtype="text"),f.sorttype?f.searchtype=f.sorttype:f.searchtype||(f.searchtype="string"),void 0===f.hidden&&(f.hidden=!1),f.label||(f.label=f.name),f.cmName=f.name,f.index&&(f.name=f.index),f.hasOwnProperty("searchoptions")||(f.searchoptions={}),f.hasOwnProperty("searchrules")||(f.searchrules={});a.showQuery&&b(this).append("<table class='queryresult "+C+"' style='display:block;max-width:440px;border:0px none;' dir='"+a.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");
var G=function(h,l){var c=[!0,""],g=v();if(b.isFunction(l.searchrules))c=l.searchrules.call(g,h,l);else if(p&&p.checkValues)try{c=p.checkValues.call(g,h,-1,l.searchrules,l.label)}catch(q){}c&&c.length&&!1===c[0]&&(a.error=!c[0],a.errmsg=c[1])};this.onchange=function(){a.error=!1;a.errmsg="";return b.isFunction(a.onChange)?a.onChange.call(v(),a,this):!1};this.reDraw=function(){b("table.group:first",this).remove();var h=this.createTableForGroup(a.filter,null);b(this).append(h);b.isFunction(a.afterRedraw)&&
a.afterRedraw.call(v(),a,this)};this.createTableForGroup=function(h,l){var c=this,g,q=b("<table class='"+t("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),d="left";"rtl"===a.direction&&(d="right",q.attr("dir","rtl"));null===l&&q.append("<tr class='error' style='display:none;'><th colspan='5' class='"+D+"' align='"+d+"'></th></tr>");var k=b("<tr></tr>");q.append(k);d=b("<th colspan='5' align='"+d+"'></th>");k.append(d);if(!0===a.ruleButtons){var f=b("<select class='"+
t("searchDialog.operationSelect","opsel")+"'></select>");d.append(f);var k="",e;for(g=0;g<a.groupOps.length;g++)e=h.groupOp===c.p.groupOps[g].op?" selected='selected'":"",k+="<option value='"+c.p.groupOps[g].op+"'"+e+">"+c.p.groupOps[g].text+"</option>";f.append(k).bind("change",function(){h.groupOp=b(f).val();c.onchange()})}k="<span></span>";a.groupButton&&(k=b("<input type='button' value='+ {}' title='"+A("addGroupTitle")+"' class='"+t("searchDialog.addGroupButton","add-group")+"'/>"),k.bind("click",
function(){void 0===h.groups&&(h.groups=[]);h.groups.push({groupOp:a.groupOps[0].op,rules:[],groups:[]});c.reDraw();c.onchange();return!1}));d.append(k);if(!0===a.ruleButtons){var k=b("<input type='button' value='+' title='"+A("addRuleTitle")+"' class='"+t("searchDialog.addRuleButton","add-rule ui-add")+"'/>"),r;k.bind("click",function(){var a,d,k;void 0===h.rules&&(h.rules=[]);for(g=0;g<c.p.columns.length;g++)if(a=void 0===c.p.columns[g].search?!0:c.p.columns[g].search,d=!0===c.p.columns[g].hidden,
(k=!0===c.p.columns[g].searchoptions.searchhidden)&&a||a&&!d){r=c.p.columns[g];break}a=r.searchoptions.sopt?r.searchoptions.sopt:c.p.sopt?c.p.sopt:-1!==b.inArray(r.searchtype,c.p.strarr)?c.p.stropts:c.p.numopts;h.rules.push({field:r.name,op:a[0],data:""});c.reDraw();return!1});d.append(k)}null!==l&&(k=b("<input type='button' value='-' title='"+A("deleteGroupTitle")+"' class='"+t("searchDialog.deleteGroupButton","delete-group")+"'/>"),d.append(k),k.bind("click",function(){for(g=0;g<l.groups.length;g++)if(l.groups[g]===
h){l.groups.splice(g,1);break}c.reDraw();c.onchange();return!1}));if(void 0!==h.groups)for(g=0;g<h.groups.length;g++)d=b("<tr></tr>"),q.append(d),k=b("<td class='first'></td>"),d.append(k),k=b("<td colspan='4'></td>"),k.append(this.createTableForGroup(h.groups[g],h)),d.append(k);void 0===h.groupOp&&(h.groupOp=c.p.groupOps[0].op);if(void 0!==h.rules)for(g=0;g<h.rules.length;g++)q.append(this.createTableRowForRule(h.rules[g],h));return q};this.createTableRowForRule=function(h,l){var c=this,g=v(),f=
b("<tr></tr>"),d,k,e,n="",r;f.append("<td class='first'></td>");var m=b("<td class='columns'></td>");f.append(m);var u=b("<select class='"+t("searchDialog.label","selectLabel")+"'></select>"),x,w=[];m.append(u);u.bind("change",function(){h.field=b(u).val();var a=b(this).parents("tr:first"),d,e;for(e=0;e<c.p.columns.length;e++)if(c.p.columns[e].name===h.field){d=c.p.columns[e];break}if(d){e=b.extend({},d.editoptions||{});delete e.readonly;delete e.disabled;var l=b.extend({},e||{},d.searchoptions||
{},F(d.cmName),{id:p.randId(),name:d.name,mode:"search"});E&&"text"===d.inputtype&&!l.size&&(l.size=10);var f=p.createEl.call(g,d.inputtype,l,"",!0,c.p.ajaxSelectOptions||{},!0);b(f).addClass(t("searchDialog.elem","input-elm"));k=l.sopt?l.sopt:c.p.sopt?c.p.sopt:-1!==b.inArray(d.searchtype,c.p.strarr)?c.p.stropts:c.p.numopts;d="";var q=0,m,n;w=[];b.each(c.p.ops,function(){w.push(this.oper)});c.p.cops&&b.each(c.p.cops,function(c){w.push(c)});for(e=0;e<k.length;e++)n=k[e],x=b.inArray(k[e],w),-1!==x&&
(m=c.p.ops[x],m=void 0!==m?m.text:c.p.cops[n].text,0===q&&(h.op=n),d+="<option value='"+n+"'>"+m+"</option>",q++);b(".selectopts",a).empty().append(d);b(".selectopts",a)[0].selectedIndex=0;p.msie&&9>p.msiever()&&(e=parseInt(b("select.selectopts",a)[0].offsetWidth,10)+1,b(".selectopts",a).width(e),b(".selectopts",a).css("width","auto"));b(".data",a).empty().append(f);p.bindEv.call(g,f,l);b(".input-elm",a).bind("change",function(a){a=a.target;h.data="SPAN"===a.nodeName.toUpperCase()&&l&&b.isFunction(l.custom_value)?
l.custom_value.call(g,b(a).children(".customelement:first"),"get"):a.value;c.onchange()});setTimeout(function(){h.data=b(f).val();c.onchange()},0)}});var m=0,y,z;for(d=0;d<c.p.columns.length;d++)if(r=void 0===c.p.columns[d].search?!0:c.p.columns[d].search,y=!0===c.p.columns[d].hidden,(z=!0===c.p.columns[d].searchoptions.searchhidden)&&r||r&&!y)r="",h.field===c.p.columns[d].name&&(r=" selected='selected'",m=d),n+="<option value='"+c.p.columns[d].name+"'"+r+">"+c.p.columns[d].label+"</option>";u.append(n);
n=b("<td class='operators'></td>");f.append(n);e=a.columns[m];E&&"text"===e.inputtype&&!e.searchoptions.size&&(e.searchoptions.size=10);m=b.extend({},e.editoptions||{});delete m.readonly;delete m.disabled;m=p.createEl.call(g,e.inputtype,b.extend({},m,e.searchoptions||{},F(e.cmName),{id:p.randId(),name:e.name}),h.data,!0,c.p.ajaxSelectOptions||{},!0);if("nu"===h.op||"nn"===h.op)b(m).attr("readonly","true"),b(m).attr("disabled","true");var B=b("<select class='"+t("searchDialog.operator","selectopts")+
"'></select>");n.append(B);B.bind("change",function(){h.op=b(B).val();var a=b(this).parents("tr:first"),a=b(".input-elm",a)[0];"nu"===h.op||"nn"===h.op?(h.data="","SELECT"!==a.tagName.toUpperCase()&&(a.value=""),a.setAttribute("readonly","true"),a.setAttribute("disabled","true")):("SELECT"===a.tagName.toUpperCase()&&(h.data=a.value),a.removeAttribute("readonly"),a.removeAttribute("disabled"));c.onchange()});k=e.searchoptions.sopt?e.searchoptions.sopt:c.p.sopt?c.p.sopt:-1!==b.inArray(e.searchtype,
c.p.strarr)?c.p.stropts:c.p.numopts;n="";b.each(c.p.ops,function(){w.push(this.oper)});c.p.cops&&b.each(c.p.cops,function(c){w.push(c)});for(d=0;d<k.length;d++)z=k[d],x=b.inArray(k[d],w),-1!==x&&(y=c.p.ops[x],r=h.op===z?" selected='selected'":"",n+="<option value='"+z+"'"+r+">"+(void 0!==y?y.text:c.p.cops[z].text)+"</option>");B.append(n);n=b("<td class='data'></td>");f.append(n);n.append(m);p.bindEv.call(g,m,e.searchoptions);b(m).addClass(t("searchDialog.elem","input-elm")).bind("change",function(){h.data=
"custom"===e.inputtype?e.searchoptions.custom_value.call(g,b(this).children(".customelement:first"),"get"):b(this).val();c.onchange()});n=b("<td></td>");f.append(n);!0===a.ruleButtons&&(m=b("<input type='button' value='-' title='"+A("deleteRuleTitle")+"' class='"+t("searchDialog.deleteRuleButton","delete-rule ui-del")+"'/>"),n.append(m),m.bind("click",function(){for(d=0;d<l.rules.length;d++)if(l.rules[d]===h){l.rules.splice(d,1);break}c.reDraw();c.onchange();return!1}));return f};this.getStringForGroup=
function(a){var b="(",c;if(void 0!==a.groups)for(c=0;c<a.groups.length;c++){1<b.length&&(b+=" "+a.groupOp+" ");try{b+=this.getStringForGroup(a.groups[c])}catch(g){alert(g)}}if(void 0!==a.rules)try{for(c=0;c<a.rules.length;c++)1<b.length&&(b+=" "+a.groupOp+" "),b+=this.getStringForRule(a.rules[c])}catch(g){alert(g)}b+=")";return"()"===b?"":b};this.getStringForRule=function(e){var f="",c="",g,q,d=e.data,k;for(g=0;g<a.ops.length;g++)if(a.ops[g].oper===e.op){f=a.operands.hasOwnProperty(e.op)?a.operands[e.op]:
"";c=a.ops[g].oper;break}if(""===c&&null!=a.cops)for(k in a.cops)if(a.cops.hasOwnProperty(k)&&(c=k,f=a.cops[k].operand,b.isFunction(a.cops[k].buildQueryValue)))return a.cops[k].buildQueryValue.call(a,{cmName:e.field,searchValue:d,operand:f});for(g=0;g<a.columns.length;g++)if(a.columns[g].name===e.field){q=a.columns[g];break}if(null==q)return"";if("bw"===c||"bn"===c)d+="%";if("ew"===c||"en"===c)d="%"+d;if("cn"===c||"nc"===c)d="%"+d+"%";if("in"===c||"ni"===c)d=" ("+d+")";a.errorcheck&&G(e.data,q);return-1!==
b.inArray(q.searchtype,["int","integer","float","number","currency"])||"nn"===c||"nu"===c?e.field+" "+f+" "+d:e.field+" "+f+' "'+d+'"'};this.resetFilter=function(){a.filter=b.extend(!0,{},a.initFilter);this.reDraw();this.onchange()};this.hideError=function(){b("th."+D,this).html("");b("tr.error",this).hide()};this.showError=function(){b("th."+D,this).html(a.errmsg);b("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(a.filter)};this.toString=function(){function b(c){var a=
"(",f;if(void 0!==c.groups)for(f=0;f<c.groups.length;f++)1<a.length&&(a="OR"===c.groupOp?a+" || ":a+" && "),a+=b(c.groups[f]);if(void 0!==c.rules)for(f=0;f<c.rules.length;f++){1<a.length&&(a="OR"===c.groupOp?a+" || ":a+" && ");var d=c.rules[f];if(e.p.errorcheck){for(var k=void 0,p=void 0,k=0;k<e.p.columns.length;k++)if(e.p.columns[k].name===d.field){p=e.p.columns[k];break}p&&G(d.data,p)}a+=d.op+"(item."+d.field+",'"+d.data+"')"}a+=")";return"()"===a?"":a}var e=this;return b(a.filter)};this.reDraw();
if(a.showQuery)this.onchange();this.filter=!0}}})};b.extend(b.fn.jqFilter,{toSQLString:function(){var b="";this.each(function(){b=this.toUserFriendlyString()});return b},filterData:function(){var b;this.each(function(){b=this.p.filter});return b},getParameter:function(b){return void 0!==b&&this.p.hasOwnProperty(b)?this.p[b]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(e){"string"===typeof e&&(e=b.parseJSON(e));this.each(function(){this.p.filter=
e;this.reDraw();this.onchange()})}})});
//# sourceMappingURL=grid.filter.map
