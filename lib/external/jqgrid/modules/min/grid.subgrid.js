(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var p=c.jgrid,t=p.jqID,m=c.fn.jqGrid,A=function(){var a=c.makeArray(arguments);a[0]="subGrid"+a[0].charAt(0).toUpperCase()+a[0].substring(1);a.unshift("");a.unshift("");a.unshift(this.p);return p.feedback.apply(this,a)},r=function(a,e){return this.each(function(){if(this.grid&&null!=a&&!0===this.p.subGrid){var d=c(this).jqGrid("getInd",a,!0);
c(d).find(">td."+e).trigger("click")}})};p.extend({setSubGrid:function(){return this.each(function(){var a=this.p,e=a.subGridModel[0];a.subGridOptions=c.extend({expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0},a.subGridOptions||{});a.colNames.unshift("");a.colModel.unshift({name:"subgrid",width:p.cell_width?a.subGridWidth+a.cellLayout:a.subGridWidth,labelClasses:"jqgh_subgrid",sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0,frozen:!0});if(e)for(e.align=
c.extend([],e.align||[]),a=0;a<e.name.length;a++)e.align[a]=e.align[a]||"left"})},addSubGridCell:function(a,e,d,b){var h=this[0],l=h.p.subGridOptions;d=c.isFunction(l.hasSubgrid)?l.hasSubgrid.call(h,{rowid:d,iRow:e,iCol:a,data:b}):!0;return null==h||null==h.p||null==l?"":"<td role='gridcell' class='"+m.getGuiStyles.call(this,"subgrid.tdStart",d?"ui-sgcollapsed sgcollapsed":"")+"' "+h.formatCol(a,e)+">"+(d?"<div class='"+m.getGuiStyles.call(this,"subgrid.buttonDiv","sgbutton-div")+"'><a role='button' class='"+
m.getGuiStyles.call(this,"subgrid.button","sgbutton")+"'><span class='"+p.mergeCssClasses(l.commonIconClass,l.plusicon)+"'></span></a></div>":"&nbsp;")+"</td>"},addSubGrid:function(a,e){return this.each(function(){var d=this,b=d.p,h=b.subGridModel[0],l=function(c,b){return m.getGuiStyles.call(d,"subgrid."+c,b||"")},r=l("thSubgrid","ui-th-subgrid ui-th-column ui-th-"+b.direction),B=l("rowSubTable","ui-subtblcell"),C=l("row","ui-subgrid ui-row-"+b.direction),D=l("tdWithIcon","subgrid-cell"),E=l("tdData",
"subgrid-data"),u=function(b,a,d){d=h.align[d];a=c("<td"+(d?" style='text-align:"+d+";'":"")+"></td>").html(a);b.append(a)},x=function(a,d){var g=b.xmlReader.subgrid;c(g.root+" "+g.row,a).each(function(){var b,a,n=c("<tr class='"+B+"'></tr>");if(!0===g.repeatitems)c(g.cell,this).each(function(b){u(n,c(this).text()||"&#160;",b)});else if(b=h.mapping||h.name)for(a=0;a<b.length;a++)u(n,c(b[a],this).text()||"&#160;",a);d.append(n)})},y=function(a,d){var g,k,f,n,e,l=b.jsonReader.subgrid,m=p.getAccessor(a,
l.root);if(null!=m)for(k=0;k<m.length;k++){e=m[k];g=c("<tr class='"+B+"'></tr>");if(!0===l.repeatitems)for(l.cell&&(e=e[l.cell]),f=0;f<e.length;f++)u(g,e[f]||"&#160;",f);else if(n=h.mapping||h.name,n.length)for(f=0;f<n.length;f++)u(g,e[n[f]]||"&#160;",f);d.append(g)}},v=function(a,e,g){var k,f;k=l("legacyTable","ui-jqgrid-legacy-subgrid"+(!0===b.altRows&&c(d).jqGrid("isBootstrapGuiStyle")?" table-striped":""));var n=c("<table"+(k?" style='width:1px' role='presentation' class='"+k+"'":"")+"><thead></thead><tbody></tbody></table>"),
m=c("<tr></tr>");for(f=0;f<h.name.length;f++)k=c("<th class='"+r+"'></th>").html(h.name[f]).width(h.width[f]),m.append(k);m.appendTo(n[0].tHead);g(a,c(n[0].tBodies[0]));c("#"+t(b.id+"_"+e)).append(n);d.grid.hDiv.loading=!1;c("#load_"+t(b.id)).hide();return!1},F=function(a){var e=c(a).attr("id"),g={nd_:(new Date).getTime()},k,f;g[b.prmNames.subgridid]=e;if(!h)return!1;if(h.params)for(f=0;f<h.params.length;f++)k=b.iColByName[h.params[f]],void 0!==k&&(g[b.colModel[k].name]=c(a.cells[k]).text().replace(/\&#160\;/ig,
""));if(!d.grid.hDiv.loading)switch(d.grid.hDiv.loading=!0,c("#load_"+t(b.id)).show(),b.subgridtype||(b.subgridtype=b.datatype),c.isFunction(b.subgridtype)?b.subgridtype.call(d,g):b.subgridtype=b.subgridtype.toLowerCase(),b.subgridtype){case "xml":case "json":c.ajax(c.extend({type:b.mtype,url:c.isFunction(b.subGridUrl)?b.subGridUrl.call(d,g):b.subGridUrl,dataType:b.subgridtype,context:e,data:p.serializeFeedback.call(d,b.serializeSubGridData,"jqGridSerializeSubGridData",g),success:function(a){c(d.grid.eDiv).hide();
v(a,this,"xml"===b.subgridtype?x:y)},error:function(a,e,g){var f=void 0===b.loadSubgridError?b.loadError:b.loadSubgridError;c.isFunction(f)&&f.call(d,a,e,g);b.subGridOptions.noEmptySubgridOnError?(d.grid.hDiv.loading=!1,c("#load_"+t(b.id)).hide()):v(null,this,"xml"===b.subgridtype?x:y)}},p.ajaxOptions,b.ajaxSubgridOptions||{}))}return!1},G=function(){var e=c(this).parent("tr")[0],h=e.nextSibling,g=e.id,k=b.id+"_"+g,f=function(a){return p.mergeCssClasses(b.subGridOptions.commonIconClass,b.subGridOptions[a])},
l=1;c.each(b.colModel,function(){!0!==this.hidden&&"rn"!==this.name&&"cb"!==this.name||l++});if(c(this).hasClass("sgcollapsed")){if(!0===b.subGridOptions.reloadOnExpand||!1===b.subGridOptions.reloadOnExpand&&!c(h).hasClass("ui-subgrid")){h=1<=a?"<td colspan='"+a+"'>&#160;</td>":"";if(!A.call(d,"beforeExpand",k,g))return;c(e).after("<tr role='row' class='"+C+"'>"+h+"<td class='"+D+"'><span class='"+f("openicon")+"'></span></td><td colspan='"+parseInt(b.colNames.length-l,10)+"' class='"+E+"'><div id='"+
k+"' class='tablediv'></div></td></tr>");c(d).triggerHandler("jqGridSubGridRowExpanded",[k,g]);c.isFunction(b.subGridRowExpanded)?b.subGridRowExpanded.call(d,k,g):F(e)}else c(h).show();c(this).html("<div class='"+m.getGuiStyles.call(d,"subgrid.buttonDiv","sgbutton-div")+"'><a role='button' class='"+m.getGuiStyles.call(d,"subgrid.button","sgbutton")+"'><span class='"+f("minusicon")+"'></span></a></div>").removeClass("sgcollapsed").addClass("sgexpanded");b.subGridOptions.selectOnExpand&&c(d).jqGrid("setSelection",
g)}else if(c(this).hasClass("sgexpanded")){if(!A.call(d,"beforeCollapse",k,g))return;!0===b.subGridOptions.reloadOnExpand?c(h).remove(".ui-subgrid"):c(h).hasClass("ui-subgrid")&&c(h).hide();c(this).html("<div class='"+m.getGuiStyles.call(d,"subgrid.buttonDiv","sgbutton-div")+"'><a role='button' class='"+m.getGuiStyles.call(d,"subgrid.button","sgbutton")+"'><span class='"+f("plusicon")+"'></span></a></div>").removeClass("sgexpanded").addClass("sgcollapsed");b.subGridOptions.selectOnCollapse&&c(d).jqGrid("setSelection",
g)}return!1},z,q,w=1;if(d.grid){z=d.rows.length;void 0!==e&&0<e&&(w=e,z=e+1);for(;w<z;)q=d.rows[w],c(q).hasClass("jqgrow")&&(q=c(q.cells[a]),q.hasClass("ui-sgcollapsed")&&(b.scroll&&q.unbind("click"),q.bind("click",G))),w++;!0===b.subGridOptions.expandOnLoad&&c(d.rows).filter(".jqgrow").each(function(a,b){c(b.cells[0]).click()});d.subGridXml=function(a,b){return v(a,b,x)};d.subGridJson=function(a,b){return v(a,b,y)}}})},expandSubGridRow:function(a){return r.call(this,a,"sgcollapsed")},collapseSubGridRow:function(a){return r.call(this,
a,"sgexpanded")},toggleSubGridRow:function(a){return r.call(this,a,"ui-sgcollapsed")}})});
//# sourceMappingURL=grid.subgrid.map
