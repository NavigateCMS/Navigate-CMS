(function($,C,D,E){'use strict';var F='jAutochecklist';var G=false;var H;var I;if(!String.prototype.format){String.prototype.format=function(){var c=arguments;return this.replace(/{(\d+)}/g,function(a,b){return c[b]!==E?c[b]:a})}}$(D).on('mouseup.'+F,function(){G=false});var J={init:function(t){var u=$.extend(true,{width:200,listWidth:null,listMaxHeight:null,checkbox:false,multiple:true,absolutePosition:false,dynamicPosition:false,fallback:false,firstItemSelectAll:false,showValue:false,allowDeselectSingleList:true,popup:true,popupLogoAsValue:false,popupMaxItem:10,popupSizeDelta:100,textAllSelected:'All',textEmpty:'Please select...',textMoreItem:'and {0} more...',textNoResult:'No result found...',textSearch:'Type something...',selectorGroup:'group',selectorChild:'child',groupType:0,onClose:null,onOpen:null,onItemClick:null,remote:{cache:true,delay:0,loadMoreOnScroll:false,minLength:0,source:null,fnPredict:null,fnQuery:null}},t);if(!u.multiple){u.popup=false;u.firstItemSelectAll=false}return this.each(function(){var a=$(this);var b=a.data(F);var c=this.id;var d=this.className;var e=a.is('select');if(!a.is('ul')&&!e)return;if(b)return;var f=$.extend(true,{},u);if(e){f.multiple=this.multiple;if(!f.multiple){f.popup=false;f.firstItemSelectAll=false}}var g=a.data('json');if(g){f=$.extend(true,f,g)}var h=$('<div>').attr({'class':F+'_wrapper','tabindex':0}).width(f.width).append(('<div class="{0}_popup"></div>'+'<div class="{0}_dropdown_wrapper">'+'<div class="{0}_arrow"><div></div></div>'+'<div class="{0}_dropdown"><div class="{0}_result"></div><input class="{0}_prediction" /><input class="{0}_input" placeholder="{1}" /></div></div>'+'<ul class="{0}_list"></ul>').format(F,f.textSearch));if(d)h.addClass(d);if(c)h.attr('id',F+'_wrapper_'+c);if(!a.hasClass(F))a.addClass(F);var i=h.find('div.'+F+'_popup').width(f.width+f.popupSizeDelta-12).css({marginLeft:-f.popupSizeDelta/2});var j=h.find('div.'+F+'_dropdown');var k=h.find('div.'+F+'_result');var l=h.find('input.'+F+'_input');var m=h.find('input.'+F+'_prediction');var n=h.find('div.'+F+'_arrow');var o=h.find('ul.'+F+'_list');if(f.listWidth)o.width(f.listWidth*1-2);if(f.listMaxHeight)o.css({maxHeight:f.listMaxHeight+'px'});if(!f.popup){i.remove();i=null}var p;if(a.is('ul')){g=J._buildFromUl(a,f);p=a.data('name')}else{g=J._buildFromSelect(a,f);p=this.name}var q=J._buildItemFromJSON(g,f,p);var r=J._insertList(o,q,f,false,false);var s={popup:i,wrapper:h,dropdown:j,result:k,input:l,prediction:m,arrow:n,list:o,listItem:{li:r.li,checkbox:r.checkbox},selectAll:r.selectAll};b={elements:s,settings:f};a.data(F,b);a.after(h);a.hide();J._registerEvent(a);J._update(a);J._postProcessing(a)})},destroy:function(){return this.each(function(){var b=$(this);var c=b.data(F);if(!c)return;$(C).add(D).off('.'+F);c.elements.wrapper.remove();var d;if(b.is('ul')){d=b.children('li');c.elements.listItem.li.each(function(k,v){var a=$(this);d.eq(k).data('selected',a.hasClass('selected'))})}else{d=b.find('option,optgroup');c.elements.listItem.li.each(function(k,v){var a=$(this);d.eq(k).attr('selected',a.hasClass('selected'))})}b.removeData(F).show()})},selectAll:function(){return this.each(function(){J._selectAll($(this),true)})},deselectAll:function(){return this.each(function(){J._selectAll($(this),false)})},open:function(){return this.each(function(){J._open($(this))})},close:function(){return this.each(function(){J._close($(this))})},update:function(){return this.each(function(){J._update($(this))})},count:function(){return J._count($(this))},get:function(){return J._get($(this))},getAll:function(){return J._getAll($(this))},set:function(a,b){if(b===E)b=false;for(var i=0;i<a.length;i++)a[i]=a[i].toString();return this.each(function(){J._set($(this),a,b)})},unset:function(a){for(var i=0;i<a.length;i++)a[i]=a[i].toString();return this.each(function(){J._unset($(this),a)})},disable:function(){return this.each(function(){var a=$(this).data(F);if(!a)return;a.elements.wrapper.addClass(F+'_disabled')})},enable:function(){return this.each(function(){var a=$(this).data(F);if(!a)return;a.elements.wrapper.removeClass(F+'_disabled')})},settings:function(c){return this.each(function(){var a=$(this);var b=a.data(F);if(!b)return;b.settings=$.extend(true,b.settings,c);a.data(F,b)})},refresh:function(){return this.each(function(){var a=$(this);var b=a.data(F);if(!b)return;var c;if(settings.firstItemSelectAll)c=ul.children(':first').addClass(F+'_checkall');var d=ul.children();b.elements.listItem={li:d,checkbox:d.children('input.'+F+'_listItem_input')};b.elements.selectAll=c;a.data(F,b)})},buildFromJSON:function(a,b,c){return this.each(function(){J._buildFromJSON($(this),a,b,c)})},releaseDrag:function(){G=false},_buildFromJSON:function(a,b,c,d){var e=a.data(F);if(!e)return;var f=e.elements;var g=e.settings;var h=J._buildItemFromJSON(b||[],g,a.data('name'));var i=J._insertList(f.list,h,g,c,d,f.mobile_popup);e.elements.listItem={li:i.li,checkbox:i.checkbox};e.elements.selectAll=i.selectAll;a.data(F,e);J._update(a);J._postProcessing(a)},_registerEvent:function(l){var m=l.data(F);var n=m.settings;var o=m.elements;var p=o.wrapper;var q=o.dropdown;var r=o.input;var s=o.prediction;var t=o.result;var u=o.list;var w=o.listItem.li;var x=o.listItem.checkbox;var y=o.selectAll;var z=o.popup;var A=false;var B;r.on('keydown',function(e){var v=s.val();if(e.keyCode===9&&v&&this.value!==v){this.value=v;return false}if(e.keyCode===27){if(n.absolutePosition){var e=$.Event("keydown");e.keyCode=27;$('.'+F+'_dummy').trigger(e)}J._close(l)}}).on('keyup.'+F,function(e){var c=$(this);var d=this.value;var f=true;var g=n.remote;u.children('li.'+F+'_noresult').remove();s.val(d);if(g.source||g.fnQuery){var h=c.data('remote');if(!h||h[d]===E){clearTimeout(B);B=setTimeout(function(){if(g.fnPredict)g.fnPredict(d,s,J._predict);J._fetchData(l,d,0)},g.delay);return}else{var i=h[d];if(i&&i.length){J._buildFromJSON(l,i,true,false);f=false}}}else{if(d===''){w.show();f=false}else{if(y)y.hide();var j=new RegExp(d,'i');w.each(function(){var a=$(this);var b=a.text();if(j.test(b)){a.show();f=false}else a.hide()})}if(d==='')s.val(null);else if(!f){var k=[];w.filter(':visible').each(function(){k.push($(this).text())});J._predict(d,s,k)}}if(f){s.val(null);u.append('<li class="{0}_noresult">{1}</li>'.format(F,n.textNoResult))}}).on('focusin.'+F,function(e){e.stopPropagation()});if(z){q.on('mouseover.'+F,function(){clearTimeout(z.data('timeout'));if(J._count(l)&&!p.hasClass(F+'_disabled'))z.fadeIn()});z.on('mouseover.'+F,function(){clearTimeout(z.data('timeout'))});q.add(z).on('mouseout.'+F,function(){if(u.is(':hidden')){var a=setTimeout(function(){z.hide()},200);z.data('timeout',a)}});z.on('click.'+F,'div',function(){var a=this.className.replace(F+'_popup_item_','');u.find('input.'+F+'_input'+a).parent('li').trigger('mousedown').trigger('mouseup');J._update(l)})}u.on('click.'+F,'input.'+F+'_listItem_input',function(e){e.preventDefault()}).on('mousedown.'+F,'li.'+F+'_listItem',function(e){var a=$(this);if(a.hasClass('locked'))return false;var b;if(D.getSelection)b=D.getSelection().toString();else if(C.getSelection)b=C.getSelection();else if(C.selection)b=C.selection.createRange().text;if(b)return false;e.stopPropagation();var c=a.hasClass('selected');if(c&&!n.multiple&&!n.allowDeselectSingleList){setTimeout(function(){J._close(l)});return false}if(!G)H=[];H.push(a);if(G&&I===c)return false;var d=a.children('input.'+F+'_listItem_input');var f=x.filter(':checked');var g=J._getValFromCheckboxes(f);c=!c;if(a.hasClass(F+'_checkall')){if(n.onItemClick){if(n.onItemClick(null,a,g,J._getAll(l),c)===false){G=false;return false}}J._selectAll(l,c)}else{if(!n.multiple&&a.hasClass(n.selectorGroup))return false;var h=[];if(a.hasClass(n.selectorGroup)&&!a.hasClass('groupType2')){var j=J._getLevel(a);var k=J._getChildren(a,j,n.selectorChild);for(var i=0;i<k.length;i++)h.push(k[i].children('input.'+F+'_listItem_input'))}h.push(d);for(var i=0;i<h.length;i++){if(h[i].prop('checked')===c)h[i]=null;else h[i].prop('checked',c)}if(n.onItemClick){if(n.onItemClick(d.prop('value'),a,g,J._get(l),c)===false){for(var i=0;i<h.length;i++){if(h[i])h[i].prop('checked',!c)}G=false;return false}}J._update(l)}if(!n.multiple){setTimeout(function(){J._close(l)})}if(!G){G=true;I=c}}).on('mouseenter.'+F,'li.'+F+'_listItem',function(){if(!G)return;var a=$(this);var i;var b=false;for(var i=0;i<H.length;i++){if(a.is(H[i])){b=true;break}}if(!b)$(this).trigger('mousedown')}).on('click.'+F,'a',function(e){e.stopPropagation()}).on('mousedown.'+F,'a',function(e){e.stopPropagation()}).on('scroll.'+F,function(){var a=n.remote;if(!a.loadMoreOnScroll)return;var b=$(this);if(b.height()+5<(b.get(0).scrollHeight-b.scrollTop()))return;var c=r.val();var d=b.children('li').length;J._fetchData(l,c,d)});t.on('mousedown.'+F,function(){if(u.is(':hidden')){J._open(l);setTimeout(function(){r.trigger('focus')})}else J._close(l)});p.on('focusin.'+F,function(){if(u.is(':hidden'))J._open(l);setTimeout(function(){r.trigger('focus')});w.filter('.over').removeClass('over')}).on('focusout.'+F,function(){setTimeout(function(){if(!$(C.activeElement).closest(p).length)J._close(l)},10)}).on('keydown.'+F,function(e){var a=e.keyCode;var b=w.filter('.over');var c;if(a===40||a===38){if(a===40)c=b.length?b.last().next():w.first();else c=b.length?b.first().prev():null;if(c&&c.length){if(!A){b.removeClass('over')}c.addClass('over');if(a===40&&c.position().top+c.height()>u.height())u.scrollTop(u.scrollTop()+50);else if(a===38&&c.position().top<0)u.scrollTop(u.scrollTop()-50)}}else if(a===13){if(!b.length){w.filter(':visible').first().trigger('mousedown').trigger('mouseup')}else{b.trigger('mousedown').trigger('mouseup')}r.val(null);return false}else if(a===16){A=true}}).on('keyup.'+F,function(e){var a=e.keyCode;if(a===16)A=false}).on('mouseup.'+F,function(e){G=false;e.stopPropagation()}).on('mousedown.'+F,function(e){e.stopPropagation()})},_fetchData:function(c,d,e){var f=c.data(F);var g=f.settings;var h=g.remote;var i=f.elements.input;if(d.length<h.minLength)return;if(h.fnQuery)h.fnQuery(c,d,e,J._buildFromJSON);else{$.getJSON(h.source,{text:d,offset:e},function(a){if(!a)a=[];J._buildFromJSON(c,a,true,e>0);if(h.cache&&!e){var b=i.data('remote')||[];b[d]=a;i.data('remote',b)}})}},_postProcessing:function(a){var b=a.data(F);var c=b.elements;var d=c.wrapper;var e=c.list;e.find('a,button,:input,object').attr('tabIndex',-1);var f=d.offset();var g=d.height();var x=f.left-$(D).scrollLeft();var y=f.top-$(D).scrollTop()+g;var w=e.width()+2;var h=e.height()+2;var i=$(D).width();var j=$(D).height();if(x+w>i)e.css({left:-(i-x)});if(b.settings.dynamicPosition&&y+h>j)e.css({top:-h-g-1})},_selectAll:function(a,b){var c=a.data(F);if(!c)return;c.elements.listItem.checkbox.prop('checked',b);this._update(a)},_update:function(h){var i=h.data(F);if(!i)return;var j=i.settings;var k=i.elements.listItem.li;var l=[];var m='';var n=0;var o=0;var p=true;k.each(function(){var a=$(this);if(a.hasClass(F+'_checkall'))return;if(a.hasClass(j.selectorGroup))J._updateParent(a,j);var b=a.children('input.'+F+'_listItem_input');if(!b.length)return;var c=b.prop('checked');var v=b.val();var d=j.showValue&&v!==''?v:a.text();if(c){if(j.popup){if(o>=j.popupMaxItem)n++;else if(!n){var e=b.attr('class').match(/input(\d+)/);var f=d;if(j.popupLogoAsValue){f='<img class="logo" src="{0}" />'.format(a.find('img.logo').attr('src'))}var g=F+'_popup_item_'+e[1];if(a.hasClass('locked'))g+=' locked';m+='<div class="{0}">{1}</div>'.format(g,f)}}a.addClass('selected');l.push(d);o++}else{a.removeClass('selected');p=false}});if(i.elements.selectAll){if(p)i.elements.selectAll.addClass('selected');else{i.elements.selectAll.removeClass('selected')}}if(j.popup){if(n)m+='<div class="{0}_more">'.format(F)+j.textMoreItem.format(n)+'</div>';i.elements.popup.html(m)}var q;if(l.length)q=j.textAllSelected&&p?j.textAllSelected:l.join(', ');else q='<span class="{0}_placeholder">{1}</span>'.format(F,i.settings.textEmpty);i.elements.result.html(q)},_eventExist:function(a,b){var c=a.data('events');if(c&&c[b]!==E){for(var i=0;i<c[b].length;i++){if(c[b][i].namespace===F)return true}}return false},_open:function(b){var c=b.data(F);if(!c)return;var d=c.elements;var e=d.wrapper;if(e.hasClass(F+'_disabled'))return;var f=d.list;if(!d.list.is(':hidden'))return;if(c.settings.onOpen){if(c.settings.onOpen(J._get(b))===false)return}d.result.hide();d.input.show().trigger('keyup');d.prediction.show();e.addClass(F+'_active');if(c.settings.absolutePosition){var g=e.offset();var h=$('<div></div>').attr('class',F+'_dummy '+F+'_wrapper').width(e.width()).height(e.height());b.after(h);e.addClass(F+'_absolute').appendTo('body').css({top:g.top+3,left:g.left});var i=$(C);if(!J._eventExist(i,'mousedown')){i.on('mousedown.'+F,function(){$('ul.'+F+', select.'+F).jAutochecklist('close')})}var j=$(D);if(!J._eventExist(j,'resize')){j.on('resize.'+F,function(){var a=b.next();if(a.hasClass(F+'_dummy')){g=a.offset();e.css({top:g.top+3,left:g.left})}})}}f.fadeIn();if(d.popup)d.popup.fadeIn();$('ul.'+F+', select.'+F).not(b).jAutochecklist('close')},_close:function(a){var b=a.data(F);if(!b)return;var c=b.elements;var d=c.wrapper;if(c.list.is(':hidden'))return;if(b.settings.onClose){if(b.settings.onClose(J._get(a))===false)return}if(c.popup)c.popup.hide();c.input.hide().val(null);c.prediction.hide().val(null);c.list.hide().children('li.'+F+'_noresult').remove();c.result.show();c.listItem.li.show();d.removeClass(F+'_active');if(b.settings.absolutePosition){d.css({top:0,left:0}).removeClass(F+'_absolute');var e=a.next();if(e.hasClass(F+'_dummy'))e.replaceWith(d)}},_count:function(a){var b=a.data(F);if(!b)return 0;return b.elements.listItem.checkbox.filter(':checked').length},_get:function(a){var b=a.data(F);if(!b)return[];var c=[];b.elements.listItem.checkbox.filter(':checked').each(function(){c.push(this.value)});return c},_getAll:function(a){var b=a.data(F);if(!b)return[];var c=[];b.elements.listItem.checkbox.each(function(){c.push(this.value)});return c},_set:function(a,b,c){var d=a.data(F);if(!d)return;if(c)J._selectAll(a,false);d.elements.listItem.checkbox.each(function(){if(b.indexOf(this.value)!==-1)this.checked=true});J._update(a)},_unset:function(a,b){var c=a.data(F);if(!c)return;c.elements.listItem.checkbox.each(function(){if(b.indexOf(this.value)!==-1)this.checked=false});J._update(a)},_getLevel:function(a){var b=a.attr('class').match(/level(\d+)/);return b?b[1]:null},_getChildren:function(a,b,c){var d=a.next();if(!d.length)return[];var e=J._getLevel(d);if(e<b||(e===b&&(!d.hasClass(c))))d=null;return d?[d].concat(J._getChildren(d,b,c)):[]},_updateParent:function(a,b){var c=b.groupType;if(a.hasClass('groupType2'))c=2;else if(a.hasClass('groupType1'))c=1;else if(a.hasClass('groupType0'))c=0;if(c===2)return;var d=J._getLevel(a);var e=J._getChildren(a,d,b.selectorChild);var f;var g=a.children('input.'+F+'_listItem_input');if(c===0){f=true;for(var i=0;i<e.length;i++){if(e[i].children('input.'+F+'_listItem_input').prop('checked')===false){f=false;break}}}else{f=false;for(var i=0;i<e.length;i++){if(e[i].children('input.'+F+'_listItem_input').prop('checked')===true){f=true;break}}}if(f)a.addClass('selected');else a.removeClass('selected');g.prop('checked',f)},_getValFromCheckboxes:function(a){var b=[];a.each(function(){b.push(this.value)});return b},_buildFromUl:function(c,d){var e=[];c.children().each(function(){var t=$(this);var a=this.className||'';var b;if(a)b=J._getLevel(t);e.push({className:a,groupType:t.data('grouptype'),html:t.html(),isChild:(t.hasClass(d.selectorChild)),isGroup:t.hasClass(d.selectorGroup),level:b,locked:t.data('locked'),parentBound:t.data('parentbound'),selected:t.data('selected'),val:t.data('value')||''})});return e},_buildFromSelect:function(a,b){var c=[];a.children().each(function(){var t=$(this);if(t.is('optgroup')){c.push({className:(this.className||'')+' '+b.selectorGroup,groupType:t.data('grouptype'),html:this.label,isChild:false,isGroup:true,level:null,locked:false,selected:false,val:null});t.children().each(function(){c.push({className:(this.className||'')+' '+b.selectorChild,groupType:0,html:this.innerHTML,isChild:true,isGroup:false,level:null,locked:t.data('locked'),selected:this.selected&&this.hasAttribute('selected'),val:this.hasAttribute('value')?this.value:''})})}else{c.push({className:this.className||'',groupType:0,html:this.innerHTML,isChild:false,isGroup:false,level:null,locked:t.data('locked'),selected:this.selected&&this.hasAttribute('selected'),val:this.hasAttribute('value')?this.value:''})}});return c},_buildItemFromJSON:function(a,b,c){if(!c)c=F;var d='';var i,e,val,n;var f=b.multiple?'checkbox':'radio';var g=0;for(var i=0;i<a.length;i++){e=a[i];val=(e.val===''||e.val===E||e.val===null)?'':e.val;var h=(e.className?e.className+' ':'')+F+'_listItem';var j=e.isGroup||false;if(e.groupType!==E)h+=' groupType'+e.groupType;if(e.locked)h+=' locked';var k=5;if(e.level&&e.level>1){k+=(e.level-1)*20;h+=' level'+e.level}else h+=' level1';var l=[];if(j){if(val===''){h+=' '+F+'_listItem_group_empty ';if(b.checkbox)k+=15}}else if(e.isChild){h+=' '+F+'_listItem_child';k+=20;if(b.checkbox)k+=15}if(k>5)l.push('padding-left:'+k+'px');l=l.length?'style="'+l.join(';')+'"':'';d+='<li class="{0}" {1}>'.format(h,l);if(!b.multiple&&!g)d+='<input type="hidden" name="{0}" value="" />'.format(c);if((!j||val!=='')&&(!b.firstItemSelectAll||i>0)){n=c;if(b.multiple){if(b.fallback){n+='['+g+']';d+='<input type="hidden" name="{0}" value="" />'.format(n)}else n+='[]'}d+='<input type="{0}" name="{1}" value="{2}" class="{3}_listItem_input {3}_input{5}" {4} />'.format(f,n,val,F,e.selected?'checked':'',g++)}d+=e.html+'</li>'}return d},_insertList:function(a,b,c,d,e,f){var g,checkbox;if(d&&!b){a.html('<li class="{0}_noresult">{1}</li>'.format(F,c.textNoResult));b=$()}else{if(e)a.append(b);else a.html(b);b=a.children();if(c.firstItemSelectAll)g=a.children(':first').addClass(F+'_checkall');checkbox=b.children('input.'+F+'_listItem_input');if(c.checkbox)checkbox.show()}return{li:b,checkbox:checkbox,selectAll:g}},_predict:function(a,b,c){var d;var e=a.toLowerCase();for(var i=0;i<c.length;i++){var f=c[i].toLowerCase();var g=f.indexOf(e);g+=e.length;var h=f.indexOf(' ',g);if(g===h)h=f.indexOf(' ',g+1);d=a+(h===-1?f.substr(g):f.substring(g,h));if(d!==a){b.val(d);return false}}}};$.fn.jAutochecklist=function(a){if(J[a]){if(a.substr(0,1)==='_')$.error('Method '+a+' does not exist on jQuery.'+F);return J[a].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof a==='object'||!a){return J.init.apply(this,arguments)}else{$.error('Method '+a+' does not exist on jQuery.'+F)}}})(jQuery,document,window);